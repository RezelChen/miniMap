!function(t){var n={};function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(r,o,function(n){return t[n]}.bind(null,o));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=18)}([function(t,n,e){var r=e(10),o=e(17),c=e(11);t.exports=function(t,n){return r(t)||o(t,n)||c()}},function(t,n){t.exports=function(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}},function(t,n,e){var r=e(12),o=e(9),c=e(13);t.exports=function(t){return r(t)||o(t)||c()}},function(t,n){t.exports=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}},function(t,n){function e(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}},function(t,n,e){var r=e(10),o=e(9),c=e(11);t.exports=function(t){return r(t)||o(t)||c()}},function(t,n,e){var r=e(14),o=e(15);t.exports=function(t,n){return!n||"object"!==r(n)&&"function"!=typeof n?o(t):n}},function(t,n){function e(n){return t.exports=e=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},e(n)}t.exports=e},function(t,n,e){var r=e(16);t.exports=function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&r(t,n)}},function(t,n){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,n){t.exports=function(t){if(Array.isArray(t))return t}},function(t,n){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(t,n){t.exports=function(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}},function(t,n){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(t,n){function e(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=e=function(t){return typeof t}:t.exports=e=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(n)}t.exports=e},function(t,n){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,n){function e(n,r){return t.exports=e=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},e(n,r)}t.exports=e},function(t,n){t.exports=function(t,n){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var e=[],r=!0,o=!1,c=void 0;try{for(var i,u=t[Symbol.iterator]();!(r=(i=u.next()).done)&&(e.push(i.value),!n||e.length!==n);r=!0);}catch(t){o=!0,c=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw c}}return e}}},function(t,n,e){"use strict";e.r(n);var r,o,c=e(2),i=e.n(c),u=e(5),a=e.n(u),s=e(1),f=e.n(s),l="UP",h="DOWN",y="RIGHT",p="LEFT",_="MAP",x="ORG",v=function(t){return null!=t},I=function(t){return t%2==0},T=function(t,n){return function(t){return t.reduce((function(t,n){return t.concat(n)}),[])}(t.map(n))},g=function(t,n){return{x:t.x+n.x,y:t.y+n.y}},d=function(t,n){return{x:t.x-n.x,y:t.y-n.y}},E=function(t){return 0===t.length},O=function(t,n){return console.error(t)},m=function(t,n){return t+parseInt(Math.random()*n)},P=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];if(0!==n.length){var r=n.map((function(t){return t.x*t.x+t.y*t.y})),o=0,c=r[0];return r.forEach((function(t,n){t>c&&(c=t,o=n)})),n[o]}O("Arguments are empty")},R=(r={},f()(r,h,.5*Math.PI),f()(r,l,1.5*Math.PI),f()(r,y,0),f()(r,p,Math.PI),f()(r,"RIGHT_DOWN",1/3*Math.PI),f()(r,"LEFT_DOWN",2/3*Math.PI),f()(r,"LEFT_UP",4/3*Math.PI),f()(r,"RIGHT_UP",5/3*Math.PI),r),w=function(t){var n=R[t];return{x:Math.cos(n),y:Math.sin(n)}},M=function(t,n){var e=(t.y>0?1:-1)*n;return{x:e/t.y*t.x,y:e}},b=function(t,n){var e=(t.x>0?1:-1)*n;return{x:e,y:e/t.x*t.y}},N=function(t){var n=t.pos.x,e=t.pos.y;return{x1:n,x2:n+t.size.width,y1:e,y2:e+t.size.height}},S=e(6),U=e.n(S),H=e(7),G=e.n(H),L=e(8),F=e.n(L),k=e(0),D=e.n(k),W=e(3),C=e.n(W),j=e(4),J=e.n(j),z=function(t,n,e){var r=e.y>0?[t,n]:[n,t],o=D()(r,2),c=o[0],i=o[1],u=e.y>0?1:-1,a=Math.max(c.margin[2],i.margin[0]),s=u*(c.size.height-c.getJoint().y+a+i.getJoint().y);return{x:s/e.y*e.x,y:s}},A=function(t,n,e){var r=e.x>0?[t,n]:[n,t],o=D()(r,2),c=o[0],i=o[1],u=e.x>0?1:-1,a=Math.max(c.margin[1],i.margin[3]),s=u*(c.size.width-c.getJoint().x+a+i.getJoint().x);return{x:s,y:s/e.x*e.y}},V=function(t){return function(n,e){for(var r=[{x:0,y:0}],o=1;o<n.length;o++){var c=t(n[o-1],n[o],e);r.push(g(r[o-1],c))}return r}},B=function(t,n){return function(e,r){var o={x:0,y:0};if(0===e.length)return[];if(1===e.length)return[o];for(var c=[o,g(o,n(e[0],e[1],r))],i=2;i<e.length;i++){var u=e[i-2],a=e[i-1],s=e[i],f=c[i-2],l=c[i-1],h=P(g(f,t(u,s,r)),g(l,n(a,s,r)));c.push(h)}return c}},Z=V(A),q=V(z),K=B(A,(function(t,n,e){var r=e.x>0?[t,n]:[n,t],o=D()(r,2),c=o[0],i=o[1],u=e.x>0?1:-1,a=Math.max(c.margin[1],i.margin[3]),s=u*(c.getTopic().size.width-c.getJoint().x+a+i.getJoint().x);return{x:s,y:s/e.x*e.y}})),Q=B(z,(function(t,n,e){var r=e.y>0?[t,n]:[n,t],o=D()(r,2),c=o[0],i=o[1],u=e.y>0?1:-1,a=Math.max(c.margin[2],i.margin[0]),s=u*(c.getTopic().size.height-c.getJoint().y+a+i.getJoint().y);return{x:s/e.y*e.x,y:s}})),X=function(t){var n=t.dir.split("-"),e=D()(n,2),r=e[0],o=e[1],c=w(r),i=function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=n?[Q,K]:[q,Z],r=D()(e,2),o=r[0],c=r[1];switch(t){case h:case l:case"RIGHT_DOWN":case"LEFT_DOWN":case"LEFT_UP":case"RIGHT_UP":return o;case y:case p:return c}}(r,v(o)),u=rt(t.elts,c,i),a=D()(u,2),s=a[0],f=a[1];return t.size=s,t.margin=f,t},Y=function(t,n){return function t(e,r){return null==e?O("Rel is not ancestor",0):e===n?r:t(e.parent,g(e.pos,r))}(t,{x:0,y:0})},$=function(t,n){var e=function(n){var e=Y(n,t);return g(e,n.getJoint())};switch(n){case"LEFT_UP":case"LEFT_DOWN":case"RIGHT_UP":case"RIGHT_DOWN":return e(t.elts[0])}var r,o=t.elts.map(e),c=(r={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0},o.forEach((function(t){r.x1=Math.min(r.x1,t.x),r.y1=Math.min(r.y1,t.y),r.x2=Math.max(r.x2,t.x),r.y2=Math.max(r.y2,t.y)})),r),i={size:nt(c)},u={x:c.x1,y:c.y1};return g(u,tt(i,n))},tt=function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=t.size,o=r.width,c=r.height;switch(n){case l:return{x:o/2,y:-e};case h:return{x:o/2,y:c+e};case p:return{x:-e,y:c/2};case y:return{x:o+e,y:c/2};default:O("Unknown dir",0)}},nt=function(t){return{width:t.x2-t.x1,height:t.y2-t.y1}},et=function(t,n,e){t.forEach((function(t,r){t.pos=d(e[r],n[r])}));var r=function(t){var n={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0};return t.forEach((function(t){var e=N(t),r=e.x1,o=e.x2,c=e.y1,i=e.y2;n.x1=Math.min(n.x1,r),n.y1=Math.min(n.y1,c),n.x2=Math.max(n.x2,o),n.y2=Math.max(n.y2,i)})),n}(t),o=function(t){var n={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0};return t.forEach((function(t){var e=N(t),r=e.x1,o=e.x2,c=e.y1,i=e.y2,u=D()(t.margin,4),a=u[0],s=u[1],f=u[2],l=u[3];n.x1=Math.min(n.x1,r-l),n.y1=Math.min(n.y1,c-a),n.x2=Math.max(n.x2,o+s),n.y2=Math.max(n.y2,i+f)})),n}(t),c={x:r.x1,y:r.y1};return t.forEach((function(t){t.pos=d(t.pos,c)})),[nt(r),function(t,n){var e=-(n.x1-t.x1);return[-(n.y1-t.y1),n.x2-t.x2,n.y2-t.y2,e]}(r,o)]},rt=function(t,n,e){var r=e(t,n),o=t.map((function(t){return t.getJoint()}));return et(t,o,r)},ot=function(){function t(n){var e=this;C()(this,t),this.pos={x:0,y:0},this.size=n.size||{width:0,height:0},this.padding=n.padding||[0,0,0,0],this.margin=n.margin||[0,0,0,0];var r=D()(this.padding,4),o=r[0],c=r[1],i=r[2],u=r[3];this.size.width+=u+c,this.size.height+=o+i,this.elts=n.elts||[],this.elts.forEach((function(t){return t.parent=e})),this.IN=n.IN}return J()(t,[{key:"getJoint",value:function(){O("Undefined method",this.getJoint)}}]),t}(),ct=function(t){function n(t){var e;return C()(this,n),(e=U()(this,G()(n).call(this,t))).type="TOPIC",e.color=t.color,e}return F()(n,t),J()(n,[{key:"getJoint",value:function(){var t=v(this.IN)?this.IN:this.parent.IN;return tt(this,t)}},{key:"getTopic",value:function(){return this}}]),n}(ot),it=function(t){function n(t){var e;return C()(this,n),(e=U()(this,G()(n).call(this,t))).type="GROUP",e.dir=t.dir,e}return F()(n,t),J()(n,[{key:"getJoint",value:function(){return function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=$(t,n),o=w(n);return e=[l,h].includes(n)?M(o,e):b(o,e),g(r,e)}(this,this.IN,30)}},{key:"getTopics",value:function(){return this.elts.map((function(t){return t.getTopic()}))}}]),n}(ot),ut=function(t){function n(t){var e;return C()(this,n),(e=U()(this,G()(n).call(this,t))).type="BRANCH",e.OUTS=t.OUTS,e}return F()(n,t),J()(n,[{key:"getJoint",value:function(){return function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=t.getTopic(),o=Y(r,t),c=r.getJoint(),i=g(o,c),u=w(n);return e=[l,h].includes(n)?M(u,e):b(u,e),g(i,e)}(this,this.IN,10)}},{key:"getTopic",value:function(){return this.elts[0]}},{key:"getOutPoints",value:function(){var t=this.getTopic();return this.OUTS.map((function(n){return tt(t,n,10)}))}},{key:"createOutConns",value:function(){var t=this.getTopic();return this.OUTS.map((function(n){var e={tok:t,pos:tt(t,n)},r={tok:t,pos:tt(t,n,10)};return new at(e,r)}))}}]),n}(ot),at=function(){function t(){C()(this,t);for(var n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];this.points=e,this.type="CONN"}return J()(t,[{key:"generate",value:function(){var t=this.points.map((function(t){return g(t.tok.pos,t.pos)}));return{p1:t[0],p2:t[1],type:this.type}}}]),t}(),st=function(t,n){return n=Math.min(n,2),new ct({size:[{width:100,height:50},{width:60,height:30},{width:40,height:20}][n],margin:[5,5,5,5],color:t.color})},ft=function t(n){switch(n.type){case"TOPIC":return n;case"GROUP":return n.elts.forEach(t),X(n),n;case"BRANCH":return n.elts.forEach(t),function(t){var n=a()(t.elts),e=(n[0],n.slice(1)),r=t.getOutPoints(),o={x:0,y:0},c=[o].concat(i()(r)),u=e.map((function(t){return t.getJoint()})),s=[o].concat(i()(u)),f=et(t.elts,s,c),l=D()(f,2),h=l[0],y=l[1];t.size=h,t.margin=y}(n),n;default:logErr("Unexpect tok.type",t,n)}},lt=function t(n){switch(n.type){case"TOPIC":break;case"GROUP":n.elts.forEach(t);break;case"BRANCH":var e=a()(n.elts),r=e[0],o=e.slice(1),c=n.getOutPoints().map((function(t){return{tok:r,pos:t}}));o.forEach(t),o.forEach((function(t,n){return ht(t,c[n])})),r.connOUTS=n.createOutConns()}return n},ht=function t(n,e){switch(n.type){case"TOPIC":var r={tok:n,pos:n.getJoint()};n.connINS.push(new at(e,r));break;case"GROUP":n.elts.forEach((function(n){return t(n,e)}));break;case"BRANCH":var o={tok:n,pos:n.getJoint()},c=a()(n.elts),i=c[0];c.slice(1);i.connINS=[],i.connINS.push(new at(e,o)),t(i,o)}},yt=function t(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=st(n,e);return n.tok=r,n.children.forEach((function(n){return t(n,e+1)})),n},pt=function(t){return function t(n,e){return n.pos=g(n.pos,e),n.parent=null,function(t){return"TOPIC"===t.type}(n)?[n]:T(n.elts,(function(e){return t(e,n.pos)}))}(t,{x:0,y:0})},_t=function(t){var n=function(t){return t.generate()},e=t.filter((function(t){return v(t.connINS)})),r=t.filter((function(t){return v(t.connOUTS)})),o=T(e,(function(t){return t.connINS.map(n)})),c=T(r,(function(t){return t.connOUTS.map(n)}));return[].concat(i()(o),i()(c),i()(t))},xt=function(t){var n=t.map((function(t){switch(t.type){case"TOPIC":return function(t){var n=t.pos,e=n.x,r=n.y,o=t.size,c=o.width,i=o.height,u=t.color,a=(new SVG.Rect).attr({width:c,height:i,fill:u});return a.translate(e,r).radius(3),a}(t);case"CONN":return function(t){var n=t.p1,e=t.p2,r="M ".concat(n.x," ").concat(n.y," L ").concat(e.x," ").concat(e.y," Z"),o=new SVG.Path;return o.attr({d:r,stroke:"black"}),o}(t);default:return}})).filter(v),e=(new SVG.G).data("name","container");return n.forEach((function(t){return e.add(t)})),e},vt=function(t){switch(t){case"LOGIC_R":case"TIME_H":case"FISH_RIGHT_UP":case"FISH_RIGHT_DOWN":return[y];case"LOGIC_L":case"FISH_LEFT_UP":case"FISH_LEFT_DOWN":return[p];case x:case"TREE_L":case"TREE_R":case"TIME_DOWN":case"TIME_V":return[h];case"ORG_UP":case"TIME_UP":return[l];case _:return[y,p];default:O("Unknown ctx",0)}},It=function(t){switch(t){case"LOGIC_R":case"TREE_R":case"TIME_UP":case"TIME_DOWN":case"FISH_RIGHT_UP":case"FISH_RIGHT_DOWN":return p;case"LOGIC_L":case"TREE_L":case"FISH_LEFT_UP":case"FISH_LEFT_DOWN":return y;case x:return l;case"ORG_UP":return h;default:O("Unknown ctx",getInDir)}},Tt=function(t){var n=Math.ceil(t.length/2);return[t.slice(0,n),t.slice(n)]},gt=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_;n=t.struct||n;var e=t.tok;if(E(t.children))return new ut({elts:[e],OUTS:[]});var r=vt(n);switch(n){case"LOGIC_R":case"LOGIC_L":case x:case"ORG_UP":case"TREE_L":case"TREE_R":case"TIME_H":case"TIME_V":case"TIME_UP":case"TIME_DOWN":case"FISH_RIGHT_UP":case"FISH_RIGHT_DOWN":case"FISH_LEFT_UP":case"FISH_LEFT_DOWN":var o=dt(t.children,n);return new ut({elts:[e,o],OUTS:r});case _:var c=Tt(t.children),i=D()(c,2),u=i[0],a=i[1],s=dt(u,"LOGIC_R"),f=dt(a,"LOGIC_L");return new ut({elts:[e,s,f],OUTS:r});default:O("Unknown ctx",transTok)}},dt=function(t,n){var e=function(t){switch(t){case"LOGIC_R":case"TIME_H":return p;case"LOGIC_L":return y;case x:case"TIME_V":return l;case"ORG_UP":return h;case"TREE_R":case"TIME_DOWN":case"FISH_RIGHT_DOWN":return"LEFT_UP";case"TIME_UP":case"FISH_RIGHT_UP":return"LEFT_DOWN";case"TREE_L":case"FISH_LEFT_DOWN":return"RIGHT_UP";case"FISH_LEFT_UP":return"RIGHT_DOWN";default:O("Unknown ctx",0)}}(n),r=function(t){switch(t){case"LOGIC_R":case"LOGIC_L":case"TREE_R":case"TREE_L":case"TIME_UP":case"TIME_DOWN":return h;case x:case"ORG_UP":return y;case"TIME_H":return"RIGHT-INTER";case"TIME_V":return"DOWN-INTER";case"FISH_RIGHT_UP":return"RIGHT_UP";case"FISH_RIGHT_DOWN":return"RIGHT_DOWN";case"FISH_LEFT_UP":return"LEFT_UP";case"FISH_LEFT_DOWN":return"LEFT_DOWN";default:O("Unknown ctx",0)}}(n),o=function(t,n){switch(n){case"TIME_H":var e=["TIME_UP","TIME_DOWN"],r=e.map(It);return t.map((function(t,n){var o=I(n)?e[0]:e[1],c=I(n)?r[0]:r[1],i=gt(t,o);return i.IN=c,i}));case"TIME_V":var o=["TREE_R","TREE_L"],c=o.map(It);return t.map((function(t,n){var e=I(n)?o[0]:o[1],r=I(n)?c[0]:c[1],i=gt(t,e);return i.IN=r,i}));case"TIME_UP":case"TIME_DOWN":var i=It(n);return t.map((function(t){var n=gt(t,"LOGIC_R");return n.IN=i,n}));default:var u=It(n);return t.map((function(t){var e=gt(t,n);return e.IN=u,e}))}}(t,n);return new it({elts:o,IN:e,dir:r})},Et=function(){var t=function(){return m(100,150)};return"rgb(".concat(t(),", ").concat(t(),", ").concat(t(),")")},Ot=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return{children:t,color:Et()}},mt=function(){var t=function(t,n){return n.reduce((function(t,n){return n(t)}),t)}(o,[yt,gt,ft,lt,pt,_t,xt]),n=document.getElementById("test");n.innerHTML="",SVG(n).spof().style({display:"block"}).add(t)};(o=Ot([Ot([Ot()]),Ot([Ot(),Ot([Ot()]),Ot([Ot(),Ot(),Ot()]),Ot()]),Ot([Ot(),Ot()]),Ot()])).struct=_,mt(),document.getElementById("sel").addEventListener("change",(function(t){var n=t.target.value;o.struct=n,mt()})),document.getElementById("addBtn").addEventListener("click",(function(t){var n;n=m(1,3),function t(n,e){if(E(n.children))return n.children.push(Ot());var r=m(0,n.children.length-1);return 0===e?n.children.splice(r,0,Ot()):t(n.children[r],e-1)}(o,n),mt()}))}]);